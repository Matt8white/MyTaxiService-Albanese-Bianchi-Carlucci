%% *** TODO ***
%% cerca fig: e metti la rispettiva foto
\documentclass[english]{article}
\usepackage[T1]{fontenc}
\usepackage{babel}
\newcommand{\code}[1]{\texttt{#1}}
\newcommand{\issue}[3][?]{
    \paragraph{#1. #2} \mbox{}\\ #3
}
\begin{document}

\title{Code inspection}


\author{M. Albanese, M. Bianchi, A. Carlucci}

\maketitle
\tableofcontents{}

\newpage{}


\section{Description of classes}

The RealmAdapter class provides authentication and authorization functionalities
to access web resources. In particular, its role is to let users login,
logout and to check users privileges.

The class is contained in the package \code{com.sun.web.security} which contains
HTTP wrappers (\code{HttpRequestWrapper.java} and \code{HttpResponseWrapper.java}), 
helper login functions(\code{LoginProbeProvider.java} and \code{LoginStatsProvider.java}), 
an SSL factory(\code{SSLSocketFactory.java}) and some other generic helper classes.

\section{Functional roles of the assigned class}
% TODO: Mitch (vedi url in cima a google docs)

\section{List of issues}
\subsection{Common issues} % (fold)
\issue[7]{Constant declarations}{
    \code{Name} constant at Line 178 should be uppercase.
}

\issue[18]{Comments} {
The comment style is not uniform; some methods seem to be more explained, 
both through JavaDoc (see later) and several inline comments, while others 
do not have any comment for dozens of line:
\begin{itemize}
\item \code{authenticate (lines 518--622)} 
\item \code{authenticate (from line 676)} 
\item \code{invokeWebSecurityManager (from line 965)} 
\item \code{redirect (from line 1250)} 
\item \code{preAuthenticateCheck (from line 1415)} 
\item \code{validate (from line 1626)} 
\end{itemize}
}

\issue[23]{JavaDoc} {
    There are two wrong JavaDoc comments, shown in fig.~\ref{fig:jdoc}, 
    involving two constructors (lines 275--337). \\
    There are also a lot of methods without any JavaDoc comment.
    \begin{itemize}
    \item \code{WebBundleDescriptor}
    \item \code{getWebSecurityManager}
    \item \code{updateWebSecurityManager}
    \item \code{hasRole} (line 438)
    \item \code{doLogout} (line 489) 
    \item \code{authenticate} (line 518)
    \item \code{authenticate} (line 646)
    \item \code{authenticate} (line 661)
    \item \code{SecurityContext} (line 852)
    \item \code{SecurityContext} (line 856)
    \item \code{getPassword} (line 884) 
    \item \code{getPrincipal} (line 888)
    \item \code{getHostAndPort} (line 1147) 
    \item \code{redirect} (line 1250)
    \item \code{getCanonicalName} (line 1304) 
    \item \code{getResourceName} (line 1308)
    \item \code{setRealmName} (line 1343) 
    \item \code{validate} (line 1626)
    \item \code{shouldRegister} (line 1754) 
    \item \code{mapEntryToBoolean} (line 1762)
    \item \code{resetPolicyContext} (line 1790) 
    \item \code{getSecurityContextForPrincipal} (line 1959)
    \item \code{setCurrentSecurityContextWithWebPrincipal} (line 1977)
    \item \code{setCurrentSecurityContext} (line 1983)
    \item \code{initConfigHelper} (line 1988)
    \item \code{postConstruct} (line 1995)
    \end{itemize}
    
    Also, two inner classes: 
    \code{AuthenticatorProxy} (line 1798) and 
    \code{HttpMessageInfo} (1846) have no JavaDoc comment.
}

\issue[25]{Class declarations} {
    Points \textbf{A}, \textbf{B}, \textbf{C} are OK; \\ \\
    Point \textbf{D}: static variables are mainly grouped on top of 
    the class, few are mixed with non-static variables and methods 
    (249 \code{reentrancyStatus}, \code{CONF\_FILE\_NAME} and
    \code{HTTP\_SERVER\_LAYER} in line 1578). \\ \\ 
    Point \textbf{E}: instance variables are not 
    defined in the order shown in the Code Inspection Assignment 
    (see fig.\ref{fig:something}), but are logically related. \\
    This means that some protected variables appear after private ones 
    (for example see lines 188--200). \\ \\ 
    Points \textbf{F} and \textbf{G}: As for the methods, constructors correctly appear before any 
    other method.
}

\issue[26]{Method organization} {
Methods seem to be logically grouped, even if some are out of order: 
\begin{itemize}
    \item Setting up WebSecurityManager (lines 368-400)
    \item Role checking (lines 400--444)
    \item Logout(lines 448--516) and Login (lines 518--714)
    \item Run-as functions(lines 715--963)
    \item Permission check functions (lines 965--1144)
    \item Host and port management (lines 1145--1247)
    \item Redirecting (lines 1250--1300)
    \item Getters \& setters (lines 1300--1350)
    \item Security constraints (lines 1356--1394)
    \item Pre and post auth methods (lines 1415--1575)
    \item Validation (lines 1626--1750)
    \item Other getter functions (lines 1754--1793)
    \item AuthProxy class (lines 1800--2000) 
\end{itemize}
}

\issue[27]{Long methods} {
    Here's a list of some quite long methods. 
    They should be split using helper methods.
    \begin{itemize} 
        \item \code{validate} (lines from 1626)
        \item \code{getHostAndPort} (lines from 1147)
        \item \code{invokeWebSecurityManager} (lines from 965)
        \item \code{authenticate} (lines from 518) 
    \end{itemize}
}

\subsection{authenticate()} % (fold)
\issue[13]{80 characters limit}{
    There are two lines that exceed the 80 character limit: the comment
    at line 687 and the line 688. 
}

\issue[18]{Comments} {
The JavaDoc comments explaining the method parameters are not up to date 
and seem to be misleading. No comments present in method, some may be useful 
to better explain the inner workings.
}

\issue[19]{Commented out sections} {
    There is only one function commented out: \code{getExtension} at line 1316 \
    (see figure~\ref{fig:issue19}).
    According to the comment above, the function is no more useful and can 
    be safely removed.  \\
    However, some snippets are commented out for reference and must not be 
    erased according to its comment (at lines 1146 and 1691). 
}

\issue[34]{Parameters order} {
    The parameters are not aligned with what explained in the JavaDoc above; 
    however, the list of parameters is sound and presented in a reasonable order (username, password, certificate). 
}

\issue[38]{IndexOutOfBoundExceptions} {
    There could be an overflow in line 684 but the exception is caught.
}

\issue[42]{Error messages} {
Error messages are not detailed and do not provide any guidance to 
how to solve problems (\code{web.login.failed} and \code{Exception} at
line 701 and 704).
}

\issue[52]{Exception handling} {
All code is wrapped in a try catch block; Exceptions are caught at a high level, 
which means they are all caught but handled in a very general way 
(see Point~42).
}

\subsection{preSetRunAsIdentity()}

\issue[5]{Method names should be verbs} {
    \code{Pre} is not a verb; the other words are with the first letter
    capitalized so that part is ok.
}

\issue[18]{Comments} {
JavaDoc is unclear, since it does not explain exactly when the function is 
called. The code at line 722 inside is self-explainatory, but something is 
not working regarding the principals (typed names) for a certain servlet, 
as the comments in line 752--755 state.
}
\issue[33]{Declarations at the beginning of blocks} {
Only one initialization in line 749, not on top of the block; however, 
this is due to the fact a check is performed before this instruction.
}

\subsection{postSetRunAsIdentity()}

\issue[5]{Method names should be verbs} {
    \code{Post} is not a verb; the other words are with the first letter
    capitalized so that part is ok.
}

\issue[13]{80 characters limit} {
    A comment at line 843 starts after the 80th character.
}

\issue[18]{Comments} {
    Comment at line 843 (\code{always null}) does not explain why it is so.
}

\issue[33]{Declarations at the beginning of blocks} {
    Variables defined just before use, not on top of block.
}

\issue[34]{Parameters order} {
    The parameters are not aligned with what explained in the JavaDoc above; 
    however, the list of parameters is sound and presented in a reasonable 
    order (username, password, certificate). 
}


\subsection{principalSetContainsOnlyAnonymousPrincipal()}
\issue[1]{Meaningful names} {
    Variable \code{rvalue} at line 868 has an unmeaningful name.
}

\issue[13]{80 characters limit}{
    Line 867 and line 869 exceeds 80 character limit.
}

\issue[18]{Comments}{
    No comments, but code is self-explanatory.
}

\issue[36]{Return values}{
    As it might not seem, return value is coherently used during validation 
    in line 1684, where the principalSet is analyzed.
}
\subsection{invokeWebSecurityManager()}

\issue[13]{80 characters limit} {
    Lines 989 and 1031 exceeds 80 characters.
}

\issue[14]{120 characters limit} {
    Line 1031 exceeds 120 characters.
}

\issue[16]{Higher-level breaks} {
    In lines 965, 966, 967, 1003 and 1026 there are two breaks which 
    are not ``higher-level'' breaks.
}

\issue[44]{Brutish programming} {
There are duplicate checks after line 1000. 
Lines from 1000 to 1020 could be improved by putting every
\code{\_logger.isLoggable(Level.FINE)} inside \code{\_logger.fine()}.
}

\subsection{hasUserDataPermission()}



% subsection authenticate (end)

\section{Other issues}
% TODO AL E MATTIA: Vedi in cima a Google Docs per elenco bug
\end{document}
